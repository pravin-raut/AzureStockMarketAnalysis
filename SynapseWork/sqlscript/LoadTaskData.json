{
	"name": "LoadTaskData",
	"properties": {
		"folder": {
			"name": "Process"
		},
		"content": {
			"query": "\ndelete from TaskData;\ninsert into TaskData\n    (TASK_NAME,FILE_DATE,TASK_STATUS,ROW_INS_TMS)\nSELECT 'DailyActivity' as TASK_NAME , case when DayOfWeek=6 then DATEADD(day,3,ActualDate)\nwhen nh.Hol_Date is not null then DATEADD(day,2,ActualDate)\n else DATEADD(day,1,ActualDate) end as FILE_DATE, 'STARTED', Getdate() as ROW_INS_TMS\nFROM DateDimension  dd\n    left outer join Ref_NSE_Holiday nh\n    ON dd.ActualDate=coalesce(DATEADD(day,-1,cast(nh.Hol_Date as date)),DATEADD(day,-10,FOrmat(GETDATE(),'yyyy-MM-dd')))\nWHERE ActualDate=(Select coalesce(max(FILE_DATE),DATEADD(day,-10,FOrmat(GETDATE(),'yyyy-MM-dd')))\n    from TaskData)\n    and DayOfWeek not in (1,7);\n\nselect * from TaskData;\n\n\nSELECT CONCAT(Task_Name,'_',replace(FILE_DATE,'-','_'),'.csv') as FileName,\n    RIGHT(concat(0,DAY(FILE_DATE)),2) AS day,\n    RIGHT(concat(0,month(FILE_DATE)),2) AS month,\n    year(FILE_DATE) as year\nfrom TaskData\nwhere TASK_STATUS='STARTED'\nand Task_Name=@PROCESS_NAME\n",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "stockdata",
				"poolName": "stockdata"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}